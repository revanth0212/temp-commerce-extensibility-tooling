---
description: Apply when User requests deployment, Code optimization is needed or Production readiness is required.
alwaysApply: false
---
# Adobe Commerce Extension Agent - Cleanup & Deployment Readiness

## Code Cleanup & Optimization Protocol

Before deployment, ensure production-ready code through systematic cleanup and optimization. Always confirm with the user before performing cleanup operations.

**CRITICAL:** **ALWAYS** use `search-commerce-app-builder-docs` MCP tool to get the latest deployment best practices, cleanup guidelines, and production optimization recommendations before performing any cleanup or deployment operations.

### When to Initiate Cleanup

* **User requests deployment** via `aio app deploy` or similar commands
* **User explicitly asks for code cleanup** or optimization
* **Phase 4 completion** in the Integration Starter Kit workflow
* **Before production deployment** to staging or live environments

### Pre-Deployment Readiness Check

When a user requests deployment, always perform this readiness assessment:

```
"Before we proceed with deployment, I recommend ensuring your code is production-ready. Would you like me to:

1. **Add comprehensive test coverage** (if not already implemented)?
2. **Clean up unnecessary code** including unused actions, dependencies, and configuration?
3. **Optimize performance** and review security configurations?

This will ensure a robust, maintainable deployment. Should I proceed with these optimizations, or would you prefer to deploy as-is?"
```

**Based on user response:**
- **"Yes, optimize first"**: Proceed with cleanup protocol
- **"No, deploy as-is"**: Proceed with deployment but include cleanup recommendations in post-deployment summary
- **"Just tests" or "Just cleanup"**: Perform only requested optimizations

## Cleanup Categories & Procedures

### 1. Comprehensive Actions & Boilerplate Cleanup

**Check for in `/actions` directory:**
- Actions that were created during development but are no longer referenced
- Event handlers for events that are no longer subscribed to
- Duplicate or test actions in the `/actions` directory structure
- Boilerplate example actions from the Integration Starter Kit
- Debug or development-only actions
- Unused entity directories (e.g., `/actions/product/` if no product events are handled)

**Check for in `/scripts/onboarding` directory:**
- Unused event metadata in `config/events.json`
- Unused event providers in `config/providers.json`
- Unused entity-to-provider mappings in `config/starter-kit-registrations.json`
- Test or example configurations that aren't needed for production
- Boilerplate event templates that don't match actual requirements

**Check for in `/scripts/commerce-event-subscribe` directory:**
- Unused event subscriptions in `config/commerce-event-subscribe.json`
- Test event subscriptions that aren't needed for production
- Boilerplate event configurations from the starter kit
- Event subscriptions for events that aren't actually implemented

**Cleanup Process:**
```javascript
// Always confirm before cleanup
"I've identified the following cleanup opportunities:

üßπ **Actions Directory (/actions/)**
- /actions/customer/test/debug-handler (development testing only)
- /actions/order/legacy/old-processor (replaced by new implementation)
- /actions/product/ (no product events implemented - entire directory unused)
- /actions/example/ (boilerplate from starter kit)

üìã **Onboarding Scripts (/scripts/onboarding/)**
- config/events.json: 3 unused event templates for unimplemented events
- config/providers.json: 1 unused provider configuration
- config/starter-kit-registrations.json: 2 unused entity mappings

üîî **Commerce Event Subscriptions (/scripts/commerce-event-subscribe/)**
- config/commerce-event-subscribe.json: 2 unused event subscriptions
- Test event configurations that aren't needed for production

Should I remove these unused components? This will:
‚úÖ Reduce deployment size significantly
‚úÖ Eliminate potential security risks from unused code
‚úÖ Simplify maintenance and configuration
‚úÖ Remove confusing boilerplate code

Confirm removal? (yes/no)"
```

### 2. Boilerplate Code Identification & Removal

**Integration Starter Kit Boilerplate to Check:**

**Actions Directory Patterns:**
- `/actions/example/` - Example actions from starter kit
- `/actions/*/test/` - Test-only actions
- `/actions/*/debug/` - Debug-only actions
- `/actions/*/legacy/` - Replaced or deprecated actions
- Empty action directories with only placeholder files

**Configuration File Boilerplate:**
- `scripts/onboarding/config/events.json` - Unused event templates
- `scripts/onboarding/config/providers.json` - Unused provider configurations
- `scripts/onboarding/config/starter-kit-registrations.json` - Unused entity mappings
- `scripts/commerce-event-subscribe/config/commerce-event-subscribe.json` - Unused event subscriptions

**Boilerplate Cleanup Process:**
```bash
# Identify unused directories and files
find actions/ -type d -empty  # Empty directories
find actions/ -name "*.js" -size -100c  # Very small files (likely placeholders)
grep -r "TODO\|FIXME\|EXAMPLE" actions/  # Development markers

# Check for boilerplate patterns
grep -r "example\|sample\|template" actions/  # Boilerplate indicators
grep -r "test\|debug\|development" actions/  # Development-only code
```

### 3. Dependencies & Package Optimization

**Review and clean:**
- Unused npm dependencies in `package.json`
- Development-only dependencies mistakenly included in production
- Outdated packages with security vulnerabilities
- Redundant or conflicting dependency versions

**Cleanup Commands:**
```bash
# Audit and clean dependencies
npm audit fix
npm prune --production
npm outdated  # Review for updates

# Remove unused dependencies (after confirmation)
npm uninstall unused-package-1 unused-package-2
```

### 3. Configuration & Manifest Cleanup

**Clean up `manifest.yml`:**
- Remove unused action definitions
- Clean up unused environment variables and parameters
- Remove test-only configurations
- Optimize runtime settings for production

**Clean up `app.config.yaml`:**
- Remove development-only hooks and scripts
- Clean up unused service configurations
- Optimize for production deployment

### 4. Environment & Credential Cleanup

**Review and organize:**
- Remove test credentials and API keys
- Ensure production credentials are properly configured
- Clean up unused environment variables
- Verify credential isolation between environments

**Security cleanup checklist:**
```yaml
# Remove from manifest.yml (after user confirmation)
actions:
  test-action:  # ‚Üê Remove test actions
    function: test/debug.js
    inputs:
      DEBUG_MODE: true  # ‚Üê Remove debug configurations
      TEST_API_KEY: $TEST_API_KEY  # ‚Üê Remove test credentials
```

### 5. Event Subscription Cleanup

**Review Adobe I/O Events configuration:**
- Remove unused event subscriptions
- Clean up test event registrations
- Verify event provider configurations
- Remove development-only webhooks

**Cleanup Process:**
```bash
# List current subscriptions (review with user)
aio events subscription list

# Remove unused subscriptions (after confirmation)
aio events subscription delete --subscription-id unused-sub-123
```

## Code Quality & Performance Optimization

### 1. Code Structure Optimization

**Review and optimize:**
- Consolidate duplicate validation logic
- Optimize data transformation pipelines
- Remove redundant error handling
- Standardize logging and monitoring

### 2. Performance Optimizations

**Common optimizations:**
- Optimize external API call patterns
- Implement efficient caching strategies
- Reduce action cold start times
- Optimize payload processing

### 3. Security Hardening

**Final security review:**
- Verify all input validation is comprehensive
- Ensure proper error handling without information leakage
- Confirm secure credential management
- Validate webhook signature verification

## Deployment Readiness Verification

### Pre-Deployment Checklist

Before proceeding with `aio app deploy`, verify:

```
‚úÖ **Code Quality**
  - [ ] No unused actions or handlers
  - [ ] No boilerplate code from Integration Starter Kit
  - [ ] All actions serve actual business requirements
  - [ ] Dependencies are optimized and secure
  - [ ] Configuration is production-ready
  - [ ] Logging is appropriate for production

‚úÖ **Boilerplate Cleanup**
  - [ ] /actions/ directory contains only implemented actions
  - [ ] /scripts/onboarding/ configs match actual requirements
  - [ ] /scripts/commerce-event-subscribe/ contains only needed subscriptions
  - [ ] No example, test, or debug directories remain
  - [ ] No placeholder or template files in production code

‚úÖ **Security**
  - [ ] All webhooks have signature validation
  - [ ] Credentials are properly managed via default parameters
  - [ ] Input validation is comprehensive
  - [ ] Error handling doesn't leak sensitive information

‚úÖ **Testing** (if implemented)
  - [ ] All tests pass
  - [ ] Event flow testing completed
  - [ ] Security tests validate webhook protection
  - [ ] Performance tests meet requirements

‚úÖ **Configuration**
  - [ ] Environment-specific settings are correct
  - [ ] Event subscriptions match requirements
  - [ ] External system integrations are verified
  - [ ] Monitoring and logging are configured

‚úÖ **Documentation**
  - [ ] README files are updated
  - [ ] Architecture diagrams are current
  - [ ] Deployment instructions are complete
  - [ ] Troubleshooting guides are included
```

## Interactive Cleanup Workflow

### Step 1: Analysis & Recommendation

```
"I've analyzed your App Builder application and identified the following cleanup opportunities:

üßπ **Code Cleanup**
- 3 unused test actions that can be removed
- 2 development dependencies that should be moved to devDependencies
- 1 duplicate validation function that can be consolidated

üîß **Configuration Optimization**
- 4 unused environment variables in manifest.yml
- 2 test event subscriptions that can be removed
- Development logging levels should be adjusted for production

üìä **Performance Improvements**
- API call batching can be optimized in transformer.js
- Caching strategy can be improved for external lookups

Would you like me to proceed with these optimizations? I'll confirm each major change before applying it."
```

### Step 2: User Confirmation & Execution

**For each cleanup category, confirm before proceeding:**

```
"Removing unused action: /actions/debug/test-handler
This action appears to be for development testing only and is not referenced in any event subscriptions.

Proceed with removal? (yes/no)"
```

### Step 3: Cleanup Execution & Verification

**After each cleanup operation:**
```
"‚úÖ Removed unused action: /actions/debug/test-handler
‚úÖ Updated manifest.yml to remove test configurations
‚úÖ Cleaned up 2 unused dependencies

Verifying application integrity..."

# Run verification tests
aio app test  # If tests exist
aio app validate  # Check configuration validity
```

**Post-Cleanup Verification Checklist:**
```
‚úÖ **Actions Directory Verification**
- [ ] All remaining actions are referenced in event subscriptions
- [ ] No empty or placeholder action directories
- [ ] All action files contain actual implementation code
- [ ] No development-only actions remain

‚úÖ **Configuration Files Verification**
- [ ] All events in events.json have corresponding action implementations
- [ ] All providers in providers.json are actually used
- [ ] All entity mappings in starter-kit-registrations.json are valid
- [ ] All event subscriptions in commerce-event-subscribe.json are implemented

‚úÖ **Boilerplate Removal Verification**
- [ ] No "example" or "sample" directories remain
- [ ] No TODO/FIXME comments in production code
- [ ] No development-only configuration settings
- [ ] All remaining code serves actual business requirements
```

## Post-Cleanup Deployment

### Optimized Deployment Process

After cleanup, guide the deployment:

```bash
# 1. Final verification
aio app validate

# 2. Run tests (if implemented)
aio app test

# 3. Deploy with MCP tools (preferred)
# Use aio-app-deploy MCP tool for seamless deployment

# 4. Verify deployment
aio app logs --tail
```

### Post-Deployment Verification

**Verify production functionality:**
- Test event flow from Commerce to external systems
- Monitor initial event processing
- Verify external system integrations
- Check performance and error rates

## Summary Template for Integration Starter Kit

Include this cleanup guidance in Phase 4 summaries:

```
## üöÄ Deployment Readiness

Your App Builder integration is functionally complete. Before production deployment, consider these optimization steps:

### üìã **Cleanup Checklist**
- [ ] **Remove test/debug actions**: Clean up development-only code
- [ ] **Remove boilerplate code**: Clean up Integration Starter Kit examples and templates
- [ ] **Clean up /actions/ directory**: Remove unused actions and empty directories
- [ ] **Clean up /scripts/onboarding/**: Remove unused event templates and provider configs
- [ ] **Clean up /scripts/commerce-event-subscribe/**: Remove unused event subscriptions
- [ ] **Optimize dependencies**: Remove unused packages and update security
- [ ] **Production configuration**: Review manifest.yml and app.config.yaml
- [ ] **Event subscription cleanup**: Remove test subscriptions and verify production events
- [ ] **Security validation**: Verify webhook signatures and credential management

### üß™ **Testing Recommendations**
- [ ] **Event flow testing**: Verify complete Commerce ‚Üí App Builder ‚Üí External System flow
- [ ] **Security testing**: Test webhook signature validation and input sanitization  
- [ ] **Performance testing**: Validate action execution times and external API response handling
- [ ] **Error handling testing**: Test retry logic and failure scenarios

### üîß **Performance Optimization**
- [ ] **API call optimization**: Review external system integration patterns
- [ ] **Caching strategy**: Implement appropriate caching for frequently accessed data
- [ ] **Logging optimization**: Ensure production-appropriate logging levels

**Ready to deploy?** Run the cleanup protocol first for production-ready code, or proceed directly if you prefer to optimize post-deployment.
```

This protocol ensures production deployments are optimized, secure, and maintainable while always respecting user preferences and confirming major changes before execution.